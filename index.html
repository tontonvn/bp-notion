<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>血圧管理（Notion同期・体重対応）</title>
  <style>
    body { font-family: sans-serif; background:#f8fafc; margin:0; padding:20px; }
    h1 { font-size:1.4rem; }
    .card { background:#fff; padding:16px; margin-bottom:20px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    label { display:block; font-size:.9rem; margin-top:6px; }
    input,select,button { font-size:1rem; padding:8px; margin-top:2px; border:1px solid #ccc; border-radius:8px; width:100%; }
    button { background:#0ea5e9; color:#fff; border:none; cursor:pointer; margin-top:8px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { border-bottom:1px solid #ddd; padding:6px; font-size:.9rem; text-align:left; }
    .pill { padding:2px 6px; border-radius:8px; font-size:.8rem; }
    .ok { background:#d1fae5; color:#065f46; }
    .warn { background:#fef3c7; color:#92400e; }
    .bad { background:#fee2e2; color:#991b1b; }
  </style>
</head>
<body>
  <h1>血圧管理アプリ（Notion同期・体重対応）</h1>
  
  <div class="card">
    <h2>入力</h2>
    <label>収縮期（上）mmHg <input id="sbp" type="number"></label>
    <label>拡張期（下）mmHg <input id="dbp" type="number"></label>
    <label>脈拍 bpm <input id="hr" type="number"></label>
    <label>体重 kg <input id="wt" type="number" step="0.1"></label>
    <label>測定日時 <input id="dt" type="datetime-local"></label>
    <label>測定部位 
      <select id="site">
        <option value="home">家庭</option>
        <option value="office">診療室</option>
      </select>
    </label>
    <label>メモ <input id="note" type="text"></label>
    <label><input id="syncToggle" type="checkbox"> Notionに自動同期する</label>
    <button id="saveBtn">保存</button>
  </div>

  <div class="card">
    <h2>履歴</h2>
    <table id="tbl"><thead>
      <tr><th>日時</th><th>場所</th><th>上</th><th>下</th><th>脈拍</th><th>体重</th><th>判定</th><th>メモ</th></tr>
    </thead><tbody></tbody></table>
  </div>

  <script>
    const entries = JSON.parse(localStorage.getItem("bp_entries")||"[]");
    const $ = id => document.getElementById(id);
    function judge(sbp,dbp){ 
      if(sbp<130 && dbp<80) return ['達成','ok']; 
      if(sbp<135 && dbp<85) return ['やや高め','warn']; 
      return ['高め','bad']; 
    }
    function refresh(){
      const tbody=$("tbl").querySelector("tbody");
      tbody.innerHTML="";
      entries.sort((a,b)=>new Date(b.t)-new Date(a.t)).forEach(e=>{
        const j=judge(e.sbp,e.dbp);
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${e.t}</td><td>${e.site}</td><td>${e.sbp}</td><td>${e.dbp}</td><td>${e.hr||""}</td><td>${e.wt||""}</td><td><span class="pill ${j[1]}">${j[0]}</span></td><td>${e.note||""}</td>`;
        tbody.appendChild(tr);
      });
    }
    $("saveBtn").onclick=()=>{
      const sbp=$("sbp").value, dbp=$("dbp").value;
      if(!sbp||!dbp){alert("上と下を入力してください");return;}
      const item={ sbp, dbp, hr:$("hr").value, wt:$("wt").value, t:$("dt").value||new Date().toISOString(), site:$("site").value, note:$("note").value };
      entries.push(item);
      localStorage.setItem("bp_entries",JSON.stringify(entries));
      refresh();
      if($("syncToggle").checked){ alert("Notion同期はサーバー設定が必要です"); }
    };
    refresh();
  </script>
</body>
</html>
